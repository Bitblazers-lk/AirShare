#pragma checksum "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "26571466b7857aeab3fe94990580f4fde6d7a48e"
// <auto-generated/>
#pragma warning disable 1591
namespace AirShare.Controls
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "/media/cc/Projects/CodeProjects/AirShare/AirShare/_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "/media/cc/Projects/CodeProjects/AirShare/AirShare/_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/media/cc/Projects/CodeProjects/AirShare/AirShare/_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/media/cc/Projects/CodeProjects/AirShare/AirShare/_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/media/cc/Projects/CodeProjects/AirShare/AirShare/_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "/media/cc/Projects/CodeProjects/AirShare/AirShare/_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "/media/cc/Projects/CodeProjects/AirShare/AirShare/_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "/media/cc/Projects/CodeProjects/AirShare/AirShare/_Imports.razor"
using AirShare.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
using AirShare;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/explorer")]
    public partial class Explorer : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#nullable restore
#line 8 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
 if(authed )
{


#line default
#line hidden
#nullable disable
            __builder.AddContent(0, "    ");
            __builder.OpenElement(1, "div");
            __builder.AddMarkupContent(2, "\n        ");
            __builder.OpenElement(3, "input");
            __builder.AddAttribute(4, "type", "button");
            __builder.AddAttribute(5, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 12 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                                       (() => NavigateBack())

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(6, "value", "üîô");
            __builder.CloseElement();
            __builder.AddMarkupContent(7, "\n        ");
            __builder.OpenElement(8, "input");
            __builder.AddAttribute(9, "type", "text");
            __builder.AddAttribute(10, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 13 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                                  Path

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(11, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => Path = __value, Path));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.AddMarkupContent(12, "\n        ");
            __builder.OpenElement(13, "input");
            __builder.AddAttribute(14, "type", "button");
            __builder.AddAttribute(15, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 14 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                                       (() => NavigateText())

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(16, "value", "üîç");
            __builder.CloseElement();
            __builder.AddMarkupContent(17, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(18, "\n");
            __builder.AddContent(19, "    ");
            __builder.OpenElement(20, "div");
            __builder.AddMarkupContent(21, "\n        ");
            __builder.OpenElement(22, "table");
            __builder.AddMarkupContent(23, "\n            ");
            __builder.OpenElement(24, "tbody");
            __builder.AddMarkupContent(25, "\n\n");
#nullable restore
#line 21 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                 foreach(FSEntry fse in DE?.SubDirs){

#line default
#line hidden
#nullable disable
            __builder.AddContent(26, "                    ");
            __builder.OpenElement(27, "tr");
            __builder.AddAttribute(28, "ondblclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 22 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                                     (() => Navigate(fse.Name) )

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(29, "\n                        ");
            __builder.OpenElement(30, "td");
            __builder.AddMarkupContent(31, "\n                            ");
            __builder.AddContent(32, 
#nullable restore
#line 24 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                             fse.Name

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(33, "\n                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(34, "\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(35, "\n");
#nullable restore
#line 27 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                }

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(36, "\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(37, "\n\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(38, "\n\n        ");
            __builder.OpenElement(39, "table");
            __builder.AddMarkupContent(40, "\n            ");
            __builder.OpenElement(41, "tbody");
            __builder.AddMarkupContent(42, "\n\n");
#nullable restore
#line 36 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                 foreach(FSEntry fse in DE?.Files)
                {

#line default
#line hidden
#nullable disable
            __builder.AddContent(43, "                    ");
            __builder.OpenElement(44, "tr");
            __builder.AddAttribute(45, "ondblclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 38 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                                     (() => NavigateFile(fse) )

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(46, "\n                        ");
            __builder.OpenElement(47, "td");
            __builder.AddMarkupContent(48, "\n                            ");
            __builder.AddContent(49, 
#nullable restore
#line 40 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                             fse.Name

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(50, "\n                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(51, "\n                        ");
            __builder.OpenElement(52, "td");
            __builder.AddMarkupContent(53, "\n                            ");
            __builder.AddContent(54, 
#nullable restore
#line 43 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                             fse.Atrb

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(55, "\n                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(56, "\n                    \n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(57, "\n");
#nullable restore
#line 47 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
                }

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(58, "\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(59, "\n\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(60, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(61, "\n");
#nullable restore
#line 53 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
}

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(62, "\n");
#nullable restore
#line 55 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
 if( !authed || Failed )
{

#line default
#line hidden
#nullable disable
            __builder.AddContent(63, "    ");
            __builder.OpenElement(64, "h4");
            __builder.AddContent(65, " ");
            __builder.AddContent(66, 
#nullable restore
#line 57 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
          msg

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(67, " ");
            __builder.CloseElement();
            __builder.AddMarkupContent(68, "\n");
#nullable restore
#line 58 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
}

#line default
#line hidden
#nullable disable
        }
        #pragma warning restore 1998
#nullable restore
#line 60 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
      

    User usr {get;set;}
    bool authed {get;set;}
    bool Failed {get;set;}
    string msg {get;set;}

    [Parameter]
    public string Path {get;set;}

    DirectoryEntries DE;

    
    protected override void OnInitialized()
    {
   
        Failed = false;

        

#line default
#line hidden
#nullable disable
#nullable restore
#line 78 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
         if(Path == null){
            try
            {        
                string q = new Uri(NavMan.Uri).Query.ToString().TrimStart('?');       
                Path = Uri.UnescapeDataString(q.TrimStart('?')).Trim('"');        
            }
            catch (Exception ex)
            {
                //TODO: Use more understandable err msgs
                Console.WriteLine("Path error " + ex.Message);
                msg = "Path error " + ex.Message;
                Path = "\\";
                
            }
        }

#line default
#line hidden
#nullable disable
#nullable restore
#line 92 "/media/cc/Projects/CodeProjects/AirShare/AirShare/Controls/Explorer.razor"
         

        usr = Userdata.Auth();
        if(usr == null)
        {
            msg = "Please wait...";
            authed = false;
           
            return;
        }

        LoadDir();

        Core.Log($"OnInitialized {Path}");

    }

    string LoadedPath = "`";
    void LoadDir()
    {
        if(LoadedPath == Path)
        {
            return;
        }
        LoadedPath = Path;



        if(usr != null && usr.Validate(Path))
        {
            authed = true;
        }
        else
        {
            authed = false;
            return;
        }

        


        try
        {
            DE = FSService.ListFiles(Path);
        }
        catch (Exception ex)
        {
            Console.WriteLine("Explore error " + Path + " >> " + ex.Message);
            DE = new DirectoryEntries();
            msg = "Cannot load path";
            Failed = true;

            Core.Log(msg + $"\t {Userdata.Token}");
            
        }

        StateHasChanged();
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {

        }

       // string QPath;
        try
        {        
            string q = new Uri(NavMan.Uri).Query.ToString().TrimStart('?');       
            Path = Uri.UnescapeDataString(q.TrimStart('?')).Trim('"');        
        }
        catch (Exception )
        {
            
        }

        
        Core.Log($"OnInitialized {Path}");

        LoadDir();

        if(!authed)
        {
            NavMan.NavigateTo("/?" + Uri.EscapeDataString(Path), true);
        }
    }


    public void Navigate(string name)
    {
       NavigateAbs(System.IO.Path.Combine(DE.Path, name));
    }
    public void NavigateAbs(string path)
    {
        Path = path;
        NavMan.NavigateTo("explorer?" + Uri.EscapeDataString(path), false);
        LoadDir();
        StateHasChanged();
    }

    public void NavigateBack()
    {
        NavigateAbs(FSService.ParentDir(Path));
    }

    public void NavigateText()
    {
        NavigateAbs(FSService.NavigateText(Path));
    }

    public void NavigateFile(FSEntry fse)
    {
        string fp = Uri.EscapeDataString(System.IO.Path.Combine(DE.Path, fse.Name));
        string ename = Uri.EscapeDataString(fse.Name);

        if(fse.CheckIs(FSFileAttrib.Document | FSFileAttrib.Image))
        {
            NavMan.NavigateTo($"OpenStream/{ename}?" + fp, true);
        }
        else if(fse.CheckIs(FSFileAttrib.Video))
        {
            NavMan.NavigateTo($"PlayVideo/{ename}?" + fp, true);
        }
        else if(fse.CheckIs(FSFileAttrib.Audio))
        {
            NavMan.NavigateTo($"PlayAudio/{ename}?" + fp, true);
        }
        else if(fse.CheckIs(FSFileAttrib.Text))
        {
            //TODO : OpenText
            NavMan.NavigateTo($"OpenStream/{ename}?" + fp, true);
        }
        else
        {
             OpenInNewTab($"OpenFile/{ename}?" + fp);
        }

    }

    public async void OpenInNewTab(string Path)
    {
        await JSRuntime.InvokeVoidAsync("OpenNew", Path);
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private UserData Userdata { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Microsoft.JSInterop.IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Microsoft.AspNetCore.Components.NavigationManager NavMan { get; set; }
    }
}
#pragma warning restore 1591
